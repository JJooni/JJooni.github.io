# Network Hacking is too fun! - 김찬인 대본

안녕하세요. 저는 Network Hacking is too fun! 이라는 주제로 발표를 하게 된 김찬인이라고 합니다!

일단 제 소개를 간단히 하자면 이름은 김찬인이구요 나이는 19살이고 현재 TeamH4C에서 활동 하고 있습니다.

목차는 이렇게 구성이 되어 있는데요. 크게 배경지식, 해킹 기법, 대응 방안이 있는데 해킹 기법에 필요한 배경 지식들을 그때 그때 설명하는 방식으로 진행하겠습니다. 그리고 이런 기법에 대해서 관심이 있으신 분들은 메모를 해놓으시고 나중에 공부해보시면 좋을 것 같습니다.

---

### 0. 배경지식

처음은 네트워크와 프로토콜에 대해서 설명 드릴건데요.

네트워크는 우리가 평상시에도 많이 쓰는 말이죠. 소셜 네트워크….교통 네트워크… 이런것들….

근데 이제 컴퓨터 네트워크는 서로 떨어져 있는 컴퓨터끼리 연결하는 도로라고 생각하시면 됩니다.

이제 프로토콜은 컴퓨터 사이에 메세지를 주고받기 위한 통신 방법에 대한 규칙과 약속입니다.

예를 들어 한국인끼리 한국어를 쓰고 미국인끼리 영어를 쓰듯이 컴퓨터끼리도 대화를 할 때 컴퓨터만의 언어가 필요한데요. 이 컴퓨터만의 언어가 프로토콜이라고 쉽게 생각하시면 됩니다.

여기서 제가 언어라고 했다고 프로그래밍언어라고 생각하시면 안됩니다! 완전히 다릅니다!!

이제 패킷은 통신할때 사용되는 전송물인데 패킷이 한글로 소포잖아여…? 데이터를 보내는 소포라고 생각하시면 정말 간단합니다.

다음은 HTTP 입니다. HTTP는 하이퍼 텍스트 트렌스퍼 프로토콜의 약자로 주로 웹통신을 할 때 사용됩니다.

자 예를들어 제 컴퓨터로 구글에 접속을 하면서 발생하는 요청과 응답을 모두 HTTP라고 합니다. 

아래에 사진을 보시면 이제 앞에 http https 이런것들이 붙은것들이 많이 보셨을텐데요 이제 이런게 다 HTTP 입니다.

---

### 1. DoS Attack

자 이제 첫번쩨 공격인데요 DoS Attack입니다.

DoS란 디나이얼 오브 서비스의 약자로 직역하면 서비스 거부 공격입니다.

특정 서버에게 수 많은 접속 시도를 만들어 다른 이용자가 정상적으로 서비스를 하지 못하게 하는 공격입니다.

예를 들어 웹 서버는 저희 그냥 사용하는 컴퓨터처럼 용량이 뭐 256기가 이렇게 한정되어 있듯이 자원이 한정되어 있기 때문에 접속 인원이 예를 들어 100명 200명 이렇게 한정적이에요 근데 공격자가 300명이 접속하는척 서버에게 접속 시도를 해버리게 되면 이제 정상적인 일반 사용자들은 서버가 더 이상 다른 접속을 받을 수 없기 때문에 접속을 할 수 없게 되는 것이죠. 네 DoS Attack은 이런 공격이구요. 이제 다음으로…..

---

### 1.1 DoS Attack - Syn flood Attack

DoS Attack의 공격 방법 중 하나인 Syn flood Attack입니다. 이거는 이제 서로 연결하는 과정에서

피연결측에서 접속을 받아들이기 위해 메모리에 일정 공간을 할당한 상태로 대기합니다.

이때 공격자가 많은 SYN 패킷을 보내서 피해자의 메모리가 꽉 차게 만들어 더 이상 연결을 받아들일 수 없게 만듭니다.

이게 무슨 말이냐면 제가 예를 들어 저희 팀장님과 통신을 한다고 하면은 제가 팀장님에게 저 연결할게요~~! 이렇게 메세지를 보냅니다. 이게 SYN 패킷의 역활이구요. 그러면 팀장님은 저랑 통신을 하기 위해서 컴퓨터에 메모리에 통신을 하기 위한 공간을 할당을 해요

근데 제가 일부러 이 저 연결할게요~~! 메세지를 엄청나게 많이 보내면 팀장님의 컴퓨터는 엄청난 공간을 할당하게 되는 것이죠 그래서 팀장님이 더 이상 다른 연결을 할 수 없게 만드는 공격입니다.

아래 그림은요 칼리 리눅스에서 공격을 하는 모습인데요 hping3라는 패킷 생성기를 통해서 이제 공격을 합니다.

이제 -S 옵션을 붙이면 Syn flood attack을 하실 수 있습니다.

그 아래는 이제 와이어샤크로 패킷을 캡처 한건데요 보시면 계속 Syn 메세지가 보내지고 있는 것을 보실수 있습니다.

### 1.2 DoS Attack - ICMP flood Attack

이제 다음은 ICMP flood attack입니다. ICMP란 인터넷 제어 메시지 프로토콜인데.  이거는 그냥 오로지 목적지에 패킷을 보내기 위한 내용들로만 구성되어 있습니다. 그냥 목적지까지 가기 위한 패킷이라고 생각하시면 됩니다. 근데 이 패킷의 크기를 최대한 키우고 보내면 패킷은 잘게 쪼개져서 공격대상에게 전달됩니다. 공격대상은 쪼개진 패킷을 모두 처리해야 하므로 부하가 걸리게 됩니다.

자 이거는 공격자가 패킷의 크기를 엄청나게 키웁니다.그리고 전송을 합니다. 그러면 이제 목적지로 도달하면서 많은 곳을 거치면서 가겠죠? 근데 이 많은 곳들을 거치면서 패킷이 잘게 잘게 쪼개집니다. 그러면 받는 사람은 이 쪼개진 패킷들을 모두 처리헤야되기 때문에 이제 부하가 걸리는 것이죠. 이런 원리이구요

아래는 이제 아까랑 똑같이 hping3를 사용하구요 마이너스 icmp옵션을 사용합니다.

### 1.3 DoS Attack -DDoS

자 다음은 디도스입니다. 아… 이거는 해킹을 전문적으로 안배워도 많은 사람들이 아는 해킹 기법이죠 네 

자 디도스는 디스트리뷰디드 디나이얼 오브 서비스의 약자로 직역하면 분산 서비스 거부 공격입니다.

다수의 시스템을 통해서 공격을 시도하구여 악성코드나 바이러스 등을 통해서 알반 사용자들의 PC를 감염시켜 DDoS 공격이 수행됩니다.

아래 그림을 보시면 공격자가 감염된 컴퓨터들에게 웹사이트에 접속해!라고 명령을 하면 이 많은 컴퓨터들이 웹 서버에 접속을 합니다. 그러면 웹서버는 그냥 멀쩡한 사용자가 들어오는 것으로 생각하게 되는데. 그러면 웹서버의 자원이 부족해지고. 일반 사용자들은 이제 이 웹 서버에 접속할 수 없게 되는 것이죠. 디도스는 감염된 컴퓨터가 필요하기 때문에 따로 공격하는 모습을 보여드리진 않겠습니다.

### 1.4 DoS Attack - DRDoS

자 다음은 DRDOS입니다. 여러분들잍 디도스는 익숙해도 디알도스는 익숙하지 않을거라고 생각합니다

자 DRDOS는 디스트리뷰디드 리펙트 디나이얼 오브 서비스의 약자로 직역하면 분산 반사 서비스 거부 공격입니다. 디도스보다 한층 발전된 기술이고 서버를 통해서 공격합니다. 통신시 아이피 주소를 피해자의 PC로 조작해서 

정상적으로 서비스를 하는 서버들에게 서비스를 요청합니다. 그러면 서버들은 패킷의 송신자 아이피를 보고 그 아이피 주소로 응답을 하는데 이로 인해 서비스를 요구하지도 않은 피해자에게 모든 응답이 되돌아가게 됩니다.

자 이게 무슨 말이냐면 공격자가 구글 같은 서버들에 요청을 보내는데 그 요청의 송신 아이피를 자신의 아이피가 아니라 공격대상의 아이피로 조작합니다. 그러면 요청을 받은 서버는 송신부에 적힌 아이피 주소로 응답을 하게 되는데

이때 송신부에 적힌 아이피 주소가 공격대상의 아이피이기 때문에 피해자는 아무것도 하지 않았는데 구글로부터 응답이 날라오는 것이져. 이때 공격자가 엄청난 요청을 서버들에게 보내서 공격대상에게 엄청난 응답이 가도록 해서 자원을 낭비시키는 공격입니다.

---

### 2. ARP Spoofing

자이제 도스어택은 다 끝이났구요 다음은 ARP Spoofing입니다.

일단 ARP란 어드레스 리솔루션 프로토콜의 약자로 직역하면 주소 결정 프로토콜입니다.

여러분들은 대부분 컴퓨터가 아이피 주소로만 통신한다고 생각하실텐데요 그게 아니라 아이피주소와 맥주소라는 것을 같이 사용합니다. 맥주소는 이제 컴퓨터 안에 실제로 있는  네트워크 카드의 일련번호 같은 것을 쉽게 맥주소라고 생각하시면 될거 같습니다. 아래 그림처럼 통신을 할 때 B의 맥주소인 BB로 보내야지! 이런식으로 통신을 합니다.

스푸핑은 그냥 속이다라는 뜻으로 생각하시면 될 거 같습니다.

자 이제 본격적으로 ARP 스푸핑 공격에 대해서 알아보겠습니다.

ARP 스푸핑이란 공격자가 의도적으로 특정 아이피 주소의 맥 주소를 자신의 맥 주소로 변경하는 공격입니다.

이 공격을 통해 공격자는 도청이 가능하게 됩니다. 이거는 예를 들어 A와 B가 통신을 하는데 공격자가 B의 맥주소인척 A에게 자신의 맥주소를 보내고 A의 맥주소인척 B에게 자신의 맥주소를 보냅니다. 그러면 A와 B가 서로에게 정보를 보낼 때 자신이 보낸 정보가 자신이 정한 목적지로 잘 가고 있다고 생각하지만 실은 공격자에게 가게 되는것이죠.

-다음장-

그리고 이제 공격자는 도청 중인 사실을 들키지 않기 위해서 수신 받은 데이터를 원래 목적지에 전송한다.

이거는 만약 A와 B가 통신을 하기로 약속을 하기로 했는데 A는 보냈다고 했는데 B에게 도착을 안했으면은 조금 이상하잖아요. 그래서 공격자는 이런 도청 사실을 들키지 않기 위해서 원래 목적지에 패킷을 전송합니다.

자 다음은 칼리에서 공격하는 사진인데여 arpspoof라는 프로그램을 사용하여 arp메세지를 보내는 모습이고 그 아래는 와이어 샤크로 arp메시지가 전송되는 모습을 본 화면입니다.

arp테이블을 확인하기 위해서 터미널에서 arp -a 명령어를 사용합니다.

왼쪽은 공격전 게이트웨이 입니다. 게이트웨이는 내부에서 외부로, 외부에서 내부로 들어오는 통로라고 생각하시면 됩니다. 254번이 이제 게이트웨이 아이피인데요 처음에는 b4-a9 뭐뭐뭐 였다가 공격을 하고나니 공격자인 49번과 동일한 08-00 뭐뭐로 바뀌었습니다. 이렇게 공격자가 게이트웨이의 맥주소를 바꾼것이죠. 아래 그림을 보시면 피해자인 39번에게 게이트웨이의 맥주소를 일부러 잘못 알려준 것입니다. 

자 이 fragrouter는여 제가 아까 도청 사실을 들키지 않기 위해서 원래 목적지에 데이터를 보낸다고 말 했자나여

네 그런 역할을 하는 프로그램입니다.

이거는 arp스푸핑 공격을 하고 도청을 한 모습인데여 피해자는 그냥 웹 사이트에서 로그인을 하는데 이 정보가 서버로 바로 넘어가는게 아닌 공격자를 지나서 서버로 가기 때문에 공격자가 도청할 수 있습니다. 보시면 피해자가 아이디가 teamh4c 이런 정보를 보내는데 공격자가 이제 그 정보를 봐서 뭐 아이디는 머 비밀번호는 머 이런 정보를 볼 수 있습니다.

---

### 3. DNS Spoofing

자 다음 공격은 dns spoofing입니다. 

dns란 도메인 네임 시스템의 약자로 아이피 주소를 우리가 편리하게 보거나 외울 수 있도록 영문/한글 주소로 바꾸어 주는 시스템입니다. 저희가 일반적으로 쓰는 [google.co](http://google.co)m이런거는 그냥 google.com만 가지고 접속할 수 있는게 아니라 이 도메인을 아이피주소로 바꾸어서 접속하게 되는건데여 아래 그림을 보시면 사용자가 teamh4c.com에 접속하고 싶은데 아이피주소를 모르기 때문에 dns서버에 물어봐서 아이피 주소를 받고 그 아이피 주소로 접속하게 되는겁니다. 

dns spoofing 공격은 Dns서버로 보내는 질문을 가로채서 변조된 결과를 보내는 것입니다. 

dns spoofing은 두가지 기법이 있는데여 dns서버의 ip주소를 변경하는방법과 dns요청에 위조된 패킷을 보내는 방법이 있습니다

제 발표에서 할 거는 이제 2번 기법의 내용입니다. 공격자가 dns요청에 자신이 dns서버인척 어디어디로 들어가라는 메세지를 공격자가 열여둔 서버의 아이피주소로 알려줘서 사용자가 자신의 사이트로 접속하게끔 만드는 것이죠

Dns스푸핑을 하기 위해서 arp스푸핑을 먼저 해야합니다. arp스푸핑은 앞전에 먼저 다룬 내용이기 때문에 자세한 설명을 생략하겠씁니다. 

칼리에서 vi에디터라는 텍스트 에디터로 hosts파일을 생성하고 오른쪽그림과 같이 공격자의 웹서버 ip, 속일 도메인을 작성해줍니다.
그리고 dnsspoof 명령어를 사용하여 피해자에게 정보를 전송합니다. 이렇게 하면 공격은 모두 끝난거구요

피해자의 피씨에서 확인을 해보면 teamh4c홈페이의 공격전 모습은 이러한데 공격 후 모습은 이런식으로 공격자가 원하는 모습으로 바뀌었습니다. 잘 보시면 도메인도 같고 다 똑같은데 표시되는 모습만 다르신걸 확인하실 수 있습니다. 

---

### 4. Evil Twin

자 다음은 이블 트윈 공격입니다. 이블트윈은 합법적인 네트워크인 것처럼 가장한 무선 네트워크입니다.

공격자는 합법적인 제공자처럼 행세하며 노트북이나 휴대전화로 핫스팟에 연결한 무선 사용자들을 갖고 놉니다.

아래 그림을 보시면 예를 들어 도서관에서 라이브러리 퍼브릭 와이파이란 이름으로 와이파이를 열어 뒀는데

공격자가 일부러 이 도서관 와이파이와 동일한 이름으로 와이파이를 생성합니다. 그렇게 되면 일반 사용자는 무엇이 진짜 도서관 와이파이인지 알 수가 없게 때문에 공격자의 와이파이로 접속하게 되는 것이죠.

제가 제 컴퓨터로 실험을 해봤늨데 이 와이파이 이름이 동일하면 신호가 가장센거만 표시되고 신호가 약한거는 가짜 와이파이로 판단하고 표시를 하지 않더라구여 이렇게 되면 일반 사용자가 의심없이 공격자의 와이파이로 접속하게 되겠죠? 넵

다음은 공격자가 가짜 와이파이를 통해 사용자들의 신용카드 번호등 개인정보를 훔칠 수 있고 도청까지 할 수 있습니다.

아래는 라우터 펌웨어 업그레이드를 빌미로 패스워드를 묻는 가짜 라우터 설정 페이지인데. 이거는 저희가 익숙하지 않으니까 제가 예시를 하나 들자면 스타벅스나 KTX에서 와이파이에 접속하면 로그인 하라는 웹 페이지가 뜬걸 많이들 보셨을 거에여 이제 거기서 개인정보나 비밀번호 같은것들을 물어보게 되면 일반 사용자들은 의심없이 그냥 정보를 주게 되는 것이죠. 네 이런 공격이구여

---

### 5. TCP Session Hijacking

다음은 이제 TCP라는 것을 알아야하는 데, TCP는 transmission control protocol 다른 컴퓨터와 데이터 통신을 하기 위한 프로토콜입니다. 

아래 그림은 Tcp통신을 하기전에 연결을 맺기 위한 절차이구여 설명을 드리자면

영희와 통신을 하고 싶은 철수가 먼저 안녕 이라는 씬 패킷을 보냅니다. 씬 패킷은 아까 syn flood 할 때 보셨던 것처럼 저 연결할래여!! 이런 메세지 입니다. 네 그러면 영희가 이 메세지를 받고 안녕 난 영희야라는 syn + ack메세지를 보냅니다. 그러면 철수가 다시 난 철수야 메세지를 보내고 세션이 맺어져서 데이터 교환을 하게 되는것이죠.

네 이제 이걸 알았으니 tcp 세션 하이재킹이 무슨 공격인지 알아봅시다. 일단 세션 하이재킹은 일반 사용자가 이미 시스템에 접속되어 있는 상태를 가로채는 공격입니다. TCP 세션 하이재킹은 TCP세션을 훔쳐서 새로운 시퀀스 넘버를 보내서 마치 클라이언트인척하며 연결을 이어나가는 공격인데여 아까 제가 서로 tcp 통신하기 위해서 필요한 절차라고 보여드린거 있죠? 그 과정을 통해서 세션을 맺어서 데이터를 교환하게 되는건데 이 tcp세션 하이재킹을 통해서 이미 맺어진 세션을 훔치는 것이죠 아래 그림을 보시면 피해자가 웹서버와 통신을 하고 있었는데 공격자가 이 연결을 끊고 웹서버에게 아 나 잠시 컴퓨터에 문제 생겼었어 다시 연결하자 이런식으로 정보를 보내서 마치 자신이 원래 접속하던 사람인척 연결을 하는 것이죠 이것도 마찬가지로 도청중인 사실을 들키지 않기 위해서 받은 정보를 다시 전송합니다.

다음은 어 이 그림은 좀 복잡해 보이실 수 도 있는데 전에 쉽게 생긴 그림과 동일합니다. 중간에 공격자가 서버에게 연결 종료메세지인 RST메세지를 보내서 연결을 끊습니다. 이러면 클라이언트는 갑자기 서버가 연결을 끊을것을 네트워크 연결 신호 같은 문제로 받아들이고 대기합니다. 그리고 이제 공격자가 연결할때 처음 보내는 메시지인 syn메시지를 보내서 서버와 다시 연결합니다. 이렇게 서버와 공격자가 세션을 맺고 클라이언트가 보내오는 메시지를 다시 서버에게 전송하면서 도청이 가능하게 되는것이죠.

---

### 6. 왜 이런 고전적인 취약점은 고쳐지지 않을까?

자 이제 공격에 대한 설명은 모두 끝이났구여 제가 갑자기 든 의문인데 왜 이런 고전적인 취약점이 고쳐지지 않을까란 의문이 들었습니다. 아까 arpSpoof같은 경우도 그냥 B인 사람이 나 A라고 거짓말하는 것과 똑같은데 네트워크 상에서는 왜 고쳐지지 않냐 이런거에 대해서 이야기를 해보자면 아까 앞전에 프로토콜은 저희가 사용하는 언어와 비슷한 개념이라고 말씀을 드렸잖아여 이제 갑자기 한국 정부가 한국어 금지! 안좋은점이 너무 많아!

다른 언어 쓰세요! 이렇게 되면 저희는 굉장히 당황스러울거 아니에요 바꿀려면 다시 배워야하고 그러려면 돈도 들고 시간도 들겠죠… 이렇게 되면 이제 정부의 손실은 엄청나게 크게 되겠죠. 이거와 비슷하게 프로토콜들도 쉽게 고칠수 없기 때문에 프로토콜 자체를 바꾸는게 아니라 프로토콜의 취약점을 보완하는 장비라던지 대책들이 나오고 그렇게 되는 것입니다. 

---

### 7. 대응방안

다음은 대응방안입니다. 여기 화면에 나온것은 대부분 저희가 사용하는 컴퓨터보다 큰 서버 컴퓨터를 관리하기 위해서 주로 쓰는 방안들이구요 여기서 저희가 해야할것들은 뭐 로그인 패스워드 강화, 패스워드 주기적으로 변경,

안쓰는 프로그램 지우기 이런것들이 있겠죠….

---

### 8. QnA

네 다음은 QNA입니다. 발표를 들으시면서 궁금했던 점이 있으신 분들은 지금 물어봐주시기 바랍니다.

넵 이상으로 발표를 마치겠습니다. 끝까지 들어주셔서 감사합니다.

---